!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((n=n||self).Frappe={},n.React)}(this,function(n,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var r=function(n){return n.__type="Straw",n},e=r(function(n){return[e,n]}),o=function(n){return r(function(t){return[o(n),n]})},u=function(n){return r(function(t,r,e,o){return[u(n),n(t,r,e,o)]})},i=function(n){for(var t=[],e=1;arguments.length>e;e++)t[e-1]=arguments[e];return r(function(r,e,o,u){var c=t[n](function(n,t){var r=t(n[1],e,o,u),i=r[1];return[[r[0]].concat(n[0]),i]},[[],r]),a=c[1];return[i.apply(void 0,[n].concat(c[0])),a]})},c=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return i.apply(void 0,["reduceRight"].concat(n))},a=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return r(function(t,r,e,o){var u=t.map(function(t,u){return n[u](t,r,e,o)}),i=u.map(function(n){return n[0]}),c=u.map(function(n){return n[1]});return[a.apply(void 0,i),c]})},f=function(n,t){return r(function(r,e,o,u){var i=n(t,r,e,o,u),c=i[1];return[f(n,i[0]),c]})},p=function(n,t){return f(function(t,r,e,o,u){var i=n(t,r,e,o,u);return[i,i]},t)},s=function(n){return"function"==typeof n&&"Straw"===n.__type},l=function(n,t){return f(function(t,r,e,o,u){var i=t[1],c=(0,t[0])(r,e,o,u),a=c[0],f=c[1];return n(i,f,e,o,u)?[[a,f],f]:[[a,i],i]},[t])},v=function(n,t){return f(function(n,t,r,e,o){var u=n[0],i=n[1];if(0===i)return[[u,i],null];var c=u(t,r,e,o);return[[c[0],i-1],c[1]]},[t,n])},d=function(n,t,e){return r(function(r,o,u,i){var c=e.reduce(function(t,e){var c=t[0],a=n(t[1],e,r,o,u,i),f=a[1];return[c.concat(a[0]),f]},[[],t]),a=c[1];return[d(n,t,c[0]),a]})},m=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return d(function(n,t,r,e,o,u){if(!n)return[t,n];var i=t(r,e,o,u);return[i[0],n&&i[1]]},!0,n)},y=function(n){return r(function(t,r,e,o){var u=n(t,r,e,o),i=u[1];return[y(u[0]),!i]})},h=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return r(function(t,r,e,o){for(var u=n.map(function(n,t){return[n,t]}).filter(function(n){return n[1]%2==0}),i=n.slice(),c=0;u.length>c;c++){var a=u[c],f=a[1],p=(0,a[0])(t,r,e,o),s=p[0];if(p[1]){var l=(0,n[f+1])(t,r,e,o),v=l[0],d=l[1];return i=i.slice(0,f).concat([s,v]).concat(i.slice(f+2)),[h.apply(void 0,i),d]}i=i.slice(0,f).concat(s).concat(i.slice(f+1))}return[h.apply(void 0,i),null]})},w=u(function(n,t){return t}),g=function(n){return f(function(t,r,e){var o=null===t?e:t;return[o,n>=e-o]},null)},b=function(n){return f(function(t,r,e){var o=null===t?e:t;return[o,e-o>=n]},null)},_=u(function(n,t,r){return r}),E=function(n,t){var r=n.type,e=n.ref,o=n.id;return void 0===t&&(t=function(n){return n}),u(function(n,u,i){return i&&(!r||i.type===r)&&(!e||i.ref===e)&&(!o||i.id===o)&&t(i)||void 0})},S=function(n){return f(function(t,r,e,o,u){return[!E(n,Boolean)(r,e,o,u)[1]&&t,t]},!0)},O=function(n){return p(function(t,r,e,o,u){return E(n,Boolean)(r,e,o,u)[1]||t},!1)},x=function(n,t){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])})(n,t)};var U=function(){return(U=Object.assign||function(n){for(var t,r=1,e=arguments.length;e>r;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},j={new:function(){return[]},remove:function(n){return function(t){return t.slice(0,n).concat(t.slice(n+1))}},add:function(n,t){return function(r){return void 0===n?r.concat(t):r.slice(0,n).concat(t,r.slice(n+1))}}},R={new:function(){return{}},remove:function(n){return function(t){var r=U({},t);return delete r[n],r}},add:function(n,t){return function(r){var e;return U({},r,((e={})[n]=t,e))}}},F=function(n){return function(t){var r=void 0===t?{}:t,e=r.add,u=void 0===e?o(!1):e,i=r.remove,c=void 0===i?o(!1):i;return f(function(t,r,e,o,u){var i=t[1],c=t[2],a=(0,t[0])(r,e,o,u),f=a[0],p=a[1],s=i(r,e,o,u),l=s[0],v=s[1],d=[v&&void 0!==v.id&&n.remove(v.id),p&&n.add(p.id,r)].filter(Boolean).reduce(function(n,t){return t(n)},c);return[[f,l,d],d]},[u,c,n.new()])}},P=function(n){function t(t){var r=n.call(this,t)||this;return r.strawUpdate=r.strawUpdate.bind(r),r.strawExec=r.strawExec.bind(r),r.emitEvent=r.emitEvent.bind(r),r.state={straw:r.strawExec(r.props.straw,0,null),strategies:[]},r}return function(n,t){function r(){this.constructor=n}x(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,n),t.prototype.componentDidMount=function(){var n=this,t=this.props.options.updateStrategies.reduce(function(t,r){return t.concat(r.mount(n.strawUpdate))},[]),r=Date.now();this.setState(function(n){return U({},n,{strategies:t,start:r})})},t.prototype.strawUpdate=function(n){var t=this;this.setState(function(r){return U({},r,{straw:t.strawExec(r.straw[0],Date.now()-r.start,n)})})},t.prototype.emitEvent=function(n){var t=this;return function(r){r.persist&&r.persist(),t.strawUpdate(U({},n,{data:r}))}},t.prototype.strawExec=function(n,t,r){return this.props.options.verbose&&console.log(t,r),n(null,t,r,this.emitEvent)},t.prototype.render=function(){return this.state.straw[1]},t.prototype.componentWillUnmount=function(){var n=this;this.props.options.updateStrategies.forEach(function(t,r){t.unmount(n.state.strategies[r])})},t}(t.Component),T=function(n,t){var e=[].concat(n),o=r(function(n,r,u,i){var c=e.map(function(n){return U({},n,{ref:n.ref||o})}),a=e.reduce(function(n,t){var r,e="on"+t.type[0].toUpperCase()+t.type.slice(1);return U({},n,((r={})[e]=i(U({},t,{ref:t.ref||o})),r))},{}),f=t(n,r,u,i),p=f[1];return[T(c,f[0]),U({},p,{props:U({},p.props,a)})]});return o};n.run=function(n,t,r,e,o){return void 0===r&&(r=[]),void 0===e&&(e=[]),void 0===o&&(o=[]),t.reduce(function(n,t,u){var i=n[1],c=(0,n[0])(t,r[u],e[u],o[u]);return[c[0],i.concat([c[1]])]},[n,[]])[1]},n.of=r,n.id=e,n.constant=o,n.fn=u,n.composeRight=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return i.apply(void 0,["reduceRight"].concat(n))},n.composeLeft=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return i.apply(void 0,["reduce"].concat(n))},n.compose=c,n.split=a,n.fanout=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return c(a.apply(void 0,n),u(function(t){return n.map(function(){return t})}))},n.accumState=f,n.accum=p,n.isStraw=s,n.constantify=function(n){return s(n)?n:o(n)},n.holdWhen=l,n.holdFirst=function(n){return l(function(n,t){return!n},n)},n.hold=function(n){return l(function(n,t){return t},n)},n.take=v,n.once=function(n){return v(1,n)},n.reduce=d,n.and=m,n.or=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return d(function(n,t,r,e,o,u){if(n)return[t,n];var i=t(r,e,o,u);return[i[0],n||i[1]]},!1,n)},n.not=y,n.when=h,n.time=w,n.atTime=function(n,t){return void 0===t&&(t=0),u(function(r,e){return!(e-t>n||n>e+t)})},n.periodicTime=function(n){return f(function(t,r,e){return[null===t?e:t,Math.floor(e/n)%2==0]},null)},n.beforeTime=g,n.afterTime=b,n.betweenTimes=function(n,t){return m(g(t),b(n))},n.event=_,n.emit=function(n){return u(function(t,r,e,o){return o(n)({})})},n.on=E,n.beforeEvent=S,n.afterEvent=O,n.betweenEvents=function(n,t){return m(O(n),S(t))},n.dynamicStructure=F,n.dynamicArray=function(n){return F(j)(n)},n.dynamicMap=function(n){return F(R)(n)},n.promise=function(n){var t=u(function(r,e,o,u){n(r,e,o,u).then(u({type:"promise-resolve",ref:t})).catch(u({type:"promise-error",ref:t}))});return t},n.ReactRunner=P,n.timeStrategy=function(n){return{mount:function(t){return setInterval(t,n||1e3/60)},unmount:function(n){return clearInterval(n)}}},n.animationFrameStrategy=function(){return{mount:function(n){return requestAnimationFrame(n)},unmount:function(n){return cancelAnimationFrame(n)}}},n.listenOn=T,Object.defineProperty(n,"__esModule",{value:!0})});
