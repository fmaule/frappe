import React from"react";var STRAW_KEY="__type",STRAW_VALUE="Straw",of=function(n){return n[STRAW_KEY]=STRAW_VALUE,n},run=function(n,t,r,e,o){return void 0===r&&(r=[]),void 0===e&&(e=[]),void 0===o&&(o=[]),t.reduce(function(n,t,u){var i=n[1],c=(0,n[0])(t,r[u],e[u],o[u]);return[c[0],i.concat([c[1]])]},[n,[]])[1]},id=of(function(n){return[id,n]}),constant=function(n){return of(function(t){return[constant(n),n]})},fn=function(n){return of(function(t,r,e,o){return[fn(n),n(t,r,e,o)]})},composeFrom=function(n){for(var t=[],r=1;arguments.length>r;r++)t[r-1]=arguments[r];return of(function(r,e,o,u){var i=t[n](function(n,t){var r=t(n[1],e,o,u),i=r[1];return[[r[0]].concat(n[0]),i]},[[],r]),c=i[1];return[composeFrom.apply(void 0,[n].concat(i[0])),c]})},composeRight=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return composeFrom.apply(void 0,["reduceRight"].concat(n))},composeLeft=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return composeFrom.apply(void 0,["reduce"].concat(n))},compose=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return composeFrom.apply(void 0,["reduceRight"].concat(n))},split=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return of(function(t,r,e,o){var u=t.map(function(t,u){return n[u](t,r,e,o)}),i=u.map(function(n){return n[0]}),c=u.map(function(n){return n[1]});return[split.apply(void 0,i),c]})},fanout=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return compose(split.apply(void 0,n),fn(function(t){return n.map(function(){return t})}))},accumState=function(n,t){return of(function(r,e,o,u){var i=n(t,r,e,o,u),c=i[1];return[accumState(n,i[0]),c]})},accum=function(n,t){return accumState(function(t,r,e,o,u){var i=n(t,r,e,o,u);return[i,i]},t)},isStraw=function(n){return"function"==typeof n&&n[STRAW_KEY]===STRAW_VALUE},constantify=function(n){return isStraw(n)?n:constant(n)},holdWhen=function(n,t){return accumState(function(t,r,e,o,u){var i=t[1],c=(0,t[0])(r,e,o,u),a=c[0],f=c[1];return n(i,f,e,o,u)?[[a,f],f]:[[a,i],i]},[t])},holdFirst=function(n){return holdWhen(function(n,t){return!n},n)},hold=function(n){return holdWhen(function(n,t){return t},n)},take=function(n,t){return accumState(function(n,t,r,e,o){var u=n[0],i=n[1];if(0===i)return[[u,i],null];var c=u(t,r,e,o);return[[c[0],i-1],c[1]]},[t,n])},once=function(n){return take(1,n)},reduce=function(n,t,r){return of(function(e,o,u,i){var c=r.reduce(function(t,r){var c=t[0],a=n(t[1],r,e,o,u,i),f=a[1];return[c.concat(a[0]),f]},[[],t]),a=c[1];return[reduce(n,t,c[0]),a]})},and=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return reduce(function(n,t,r,e,o,u){if(!n)return[t,n];var i=t(r,e,o,u);return[i[0],n&&i[1]]},!0,n)},or=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return reduce(function(n,t,r,e,o,u){if(n)return[t,n];var i=t(r,e,o,u);return[i[0],n||i[1]]},!1,n)},not=function(n){return of(function(t,r,e,o){var u=n(t,r,e,o),i=u[1];return[not(u[0]),!i]})},when=function(){for(var n=[],t=0;arguments.length>t;t++)n[t]=arguments[t];return of(function(t,r,e,o){for(var u=n.map(function(n,t){return[n,t]}).filter(function(n){return n[1]%2==0}),i=n.slice(),c=0;u.length>c;c++){var a=u[c],f=a[1],s=(0,a[0])(t,r,e,o),p=s[0];if(s[1]){var m=(0,n[f+1])(t,r,e,o),v=m[0],d=m[1];return i=i.slice(0,f).concat([p,v]).concat(i.slice(f+2)),[when.apply(void 0,i),d]}i=i.slice(0,f).concat(p).concat(i.slice(f+1))}return[when.apply(void 0,i),null]})},time=fn(function(n,t){return t}),atTime=function(n,t){return void 0===t&&(t=0),fn(function(r,e){return!(e-t>n||n>e+t)})},periodicTime=function(n){return accumState(function(t,r,e){return[null===t?e:t,Math.floor(e/n)%2==0]},null)},beforeTime=function(n){return accumState(function(t,r,e){var o=null===t?e:t;return[o,n>=e-o]},null)},afterTime=function(n){return accumState(function(t,r,e){var o=null===t?e:t;return[o,e-o>=n]},null)},betweenTimes=function(n,t){return and(beforeTime(t),afterTime(n))},event=fn(function(n,t,r){return r}),emit=function(n){return fn(function(t,r,e,o){return o(n)({})})},on=function(n,t){var r=n.type,e=n.ref,o=n.id;return void 0===t&&(t=function(n){return n}),fn(function(n,u,i){return i&&(!r||i.type===r)&&(!e||i.ref===e)&&(!o||i.id===o)&&t(i)||void 0})},beforeEvent=function(n){return accumState(function(t,r,e,o,u){return[!on(n,Boolean)(r,e,o,u)[1]&&t,t]},!0)},afterEvent=function(n){return accum(function(t,r,e,o,u){return on(n,Boolean)(r,e,o,u)[1]||t},!1)},betweenEvents=function(n,t){return and(afterEvent(n),beforeEvent(t))},extendStatics=function(n,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])})(n,t)};function __extends(n,t){function r(){this.constructor=n}extendStatics(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(n){for(var t,r=1,e=arguments.length;e>r;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},arrayDriver={new:function(){return[]},remove:function(n){return function(t){return t.slice(0,n).concat(t.slice(n+1))}},add:function(n,t){return function(r){return void 0===n?r.concat(t):r.slice(0,n).concat(t,r.slice(n+1))}}},mapDriver={new:function(){return{}},remove:function(n){return function(t){var r=__assign({},t);return delete r[n],r}},add:function(n,t){return function(r){var e;return __assign({},r,((e={})[n]=t,e))}}},dynamicStructure=function(n){return function(t){var r=void 0===t?{}:t,e=r.add,o=void 0===e?constant(!1):e,u=r.remove,i=void 0===u?constant(!1):u;return accumState(function(t,r,e,o,u){var i=t[1],c=t[2],a=(0,t[0])(r,e,o,u),f=a[0],s=a[1],p=i(r,e,o,u),m=p[0],v=p[1],d=[v&&void 0!==v.id&&n.remove(v.id),s&&n.add(s.id,r)].filter(Boolean).reduce(function(n,t){return t(n)},c);return[[f,m,d],d]},[o,i,n.new()])}},dynamicArray=function(n){return dynamicStructure(arrayDriver)(n)},dynamicMap=function(n){return dynamicStructure(mapDriver)(n)},promise=function(n){var t=fn(function(r,e,o,u){n(r,e,o,u).then(u({type:"promise-resolve",ref:t})).catch(u({type:"promise-error",ref:t}))});return t},ReactRunner=function(n){function t(t){var r=n.call(this,t)||this;return r.strawUpdate=r.strawUpdate.bind(r),r.strawExec=r.strawExec.bind(r),r.emitEvent=r.emitEvent.bind(r),r.state={straw:r.strawExec(r.props.straw,0,null),strategies:[]},r}return __extends(t,n),t.prototype.componentDidMount=function(){var n=this,t=this.props.options.updateStrategies.reduce(function(t,r){return t.concat(r.mount(n.strawUpdate))},[]),r=Date.now();this.setState(function(n){return __assign({},n,{strategies:t,start:r})})},t.prototype.strawUpdate=function(n){var t=this;this.setState(function(r){return __assign({},r,{straw:t.strawExec(r.straw[0],Date.now()-r.start,n)})})},t.prototype.emitEvent=function(n){var t=this;return function(r){r.persist&&r.persist(),t.strawUpdate(__assign({},n,{data:r}))}},t.prototype.strawExec=function(n,t,r){return this.props.options.verbose&&console.log(t,r),n(null,t,r,this.emitEvent)},t.prototype.render=function(){return this.state.straw[1]},t.prototype.componentWillUnmount=function(){var n=this;this.props.options.updateStrategies.forEach(function(t,r){t.unmount(n.state.strategies[r])})},t}(React.Component),timeStrategy=function(n){return{mount:function(t){return setInterval(t,n||1e3/60)},unmount:function(n){return clearInterval(n)}}},animationFrameStrategy=function(){return{mount:function(n){return requestAnimationFrame(n)},unmount:function(n){return cancelAnimationFrame(n)}}},listenOn=function(n,t){var r=[].concat(n),e=of(function(n,o,u,i){var c=r.map(function(n){return __assign({},n,{ref:n.ref||e})}),a=r.reduce(function(n,t){var r,o="on"+t.type[0].toUpperCase()+t.type.slice(1);return __assign({},n,((r={})[o]=i(__assign({},t,{ref:t.ref||e})),r))},{}),f=t(n,o,u,i),s=f[1];return[listenOn(c,f[0]),__assign({},s,{props:__assign({},s.props,a)})]});return e};export{run,of,id,constant,fn,composeRight,composeLeft,compose,split,fanout,accumState,accum,isStraw,constantify,holdWhen,holdFirst,hold,take,once,reduce,and,or,not,when,time,atTime,periodicTime,beforeTime,afterTime,betweenTimes,event,emit,on,beforeEvent,afterEvent,betweenEvents,dynamicStructure,dynamicArray,dynamicMap,promise,ReactRunner,timeStrategy,animationFrameStrategy,listenOn};
